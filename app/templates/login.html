{% extends "base.html" %}

{% block title %}Giriş Yap · Diş Kliniği{% endblock %}

{% block content %}
<div class="flex items-center justify-center min-h-[80vh]">
    <div id="sign-in"></div>
</div>
{% endblock %}

{% block scripts %}
<script
  async
  crossorigin="anonymous"
  data-clerk-publishable-key="{{ clerk_pub_key }}"
  src="https://cdn.jsdelivr.net/npm/@clerk/clerk-js@latest/dist/clerk.browser.js"
  type="text/javascript"
></script>

<script>
  window.addEventListener("load", async function () {
    await Clerk.load();

    // --- EKLENEN KISIM BAŞLANGIÇ ---
    // Eğer URL'den veya Flask'tan çıkış komutu geldiyse Clerk'ten de çıkış yap
    const forceSignout = "{{ force_signout }}";
    
    if (forceSignout === "true") {
        console.log("Zorla çıkış yapılıyor...");
        await Clerk.signOut();
    }
    // --- EKLENEN KISIM BİTİŞ ---

    if (Clerk.user) {
        // Zaten giriş yapmışsa Dashboard'a yönlendir
        window.location.href = "/auth/check-clerk";
    } else {
        // Giriş yapmamışsa kutuyu göster
        const signInDiv = document.getElementById("sign-in");
        
        Clerk.mountSignIn(signInDiv, {
            afterSignInUrl: "/auth/check-clerk",
            afterSignUpUrl: "/auth/check-clerk",
            appearance: {
                elements: {
                    card: "shadow-xl border border-gray-100 rounded-2xl"
                }
            }
        });
    }
  });
</script>
{% endblock %}